# 21.2 로그 포맷(~21.2.4)

## 1. 개요

- 로그 포맷에는 여러 표준이 있는데 이 장에서는 가장 일반적인 포맷만 몇 가지 다뤄볼 것
- 상용 혹은 오픈 소스 HTTP 애플리케이션은 대부분, 표준 로그 포맷을 한 개 이상 지원한다
- 그리고 그 애플리케이션 대부분이 로그 포맷을 설정하고 자체 맞춤 포맷을 만들 수 있는 설정 기능을 제공한다
- 애플리케이션이 더 많은 표준 포맷을 지원하고 관리자가 그것을 사용함으로써 얻는 가장 큰 이점은 `예를 들어 로그에서 통계를 추출하는 도구를 사용할 경우 관리자가 직접 지정한 필드를 포함한 로그 포맷을 통해 필요한 통계를 추출할 수 있기 때문에 그 도구를 더 잘 활용할 수 있다는 것`이다
- 많은 오픈 소스 혹은 상용 패키지가 통계를 뽑으려고 로그를 분석하는데 여기에 표준 로그 포맷을 이용해서 애플리케이션과 관리자가 이러한 리소스들을 잘 활용할 수 있다

## 2. 일반 로그 포맷(Common Log Format)(21.2.1)

- 요즘 사용하는 가장 일반적인 포맷 중 하나는 그 이름도 적절한 `일반 로그 포맷`이다
- 본래 NSCA 가 정의했고 많은 서버가 이 로그 포맷을 기본으로 사용한다
- 대부분의 상용 혹은 오픈 소스 서버는 이 포맷을 사용하게 설정할 수 있으며 일반 로그 포맷 파일을 구문분석하는 수많은 상용 혹은 무료 소프트웨어 도구가 있다
- 아래는 일반 로그 포맷의 필드를 순서대로 나열하였다

| 필드          | 설명                                                                                                                                            |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| remotehost    | 요청한 컴퓨터의 호스트명 혹은 IP주소(서버가 리버스 DNS 를 수행하게 설정되어 있지 않거나 요청자의 호스트 명을 찾을 수 없으면 IP 주소를 기술한다) |
| username      | ident 검색을 수행했다면 인증된 요청자의 사용자 이름이 있다                                                                                      |
| auth-username | 인증을 수행했다면 인증된 요청자의 사용자 이름이 있다                                                                                            |
| timestamp     | 요청 날짜와 시간                                                                                                                                |
| request-line  | HTTP 요청의 행을 그대로 기술한다. 예를 들어 GET/index.html HTTP/1.1                                                                             |
| response-code | 응답으로 보내는 HTTP 상태 코드                                                                                                                  |
| response-size | 응답 엔터티의 Content-Length. 응답으로 아무런 엔터티도 반환하지 않으면 값이 0이 된다                                                            |

## 3. 혼합 로그 포맷(Combined Log Format)(21.2.2)

- 많이 사용하는 또 다른 로그 포맷은 `혼합 로그 포맷`
- 이 포맷은 아파치 같은 서버들이 지원한다
- 혼합 로그 포맷은 일반 로그 포맷과 매우 유사하다
- 사실 추가된 필드 두 개를 제외하면 똑같다
- Referer 필드는 이 URL을 요청자가 어디서 찾았는지에 관한 정보를 제공하며 User-Agent필드는 요청을 HTTP 클라이언트 애플리케이션이 무엇인지 알아볼 때 유용하다

| 필드       | 설명                              |
| ---------- | --------------------------------- |
| Referer    | Referer HTTP 헤더의 값            |
| User-Agent | User-Agent Referer HTTP 헤더의 값 |

## 4. 넷스케이프 확장 로그 포맷(21.2.3)

- 넷스케이프가 상용 HTTP 애플리케이션이 되면서 다른 HTTP 애플리케이션 개발자들이 사용하는 서버으 ㅣ여러 로그 포맷을 도입했다
- 넷스케이프의 포맷은 NCSA 일반 로그 포맷에서 시작했지만 프락시나 웹 캐시 같은 HTTP 애플리케이션과 연관이 있는 여러 환경을 지원하려고 포맷을 확장했다
- 넷스케이프 확장 로그 포맷에 잇는 첫 필드 일곱개는 일반 로그 포맷의 것과 같다
- 아래는 넷스케이프 확장 로그 포맷에 있는 새로운 필드들이 순서대로 소개되어 있다

| 필드                     | 설명                                                                                         |
| ------------------------ | -------------------------------------------------------------------------------------------- |
| proxy-response-code      | 트랜잭션이 프락시를 거칠 경우 서버에서 프락시로의 HTTP 응답 코드                             |
| proxy-response-size      | 트랜잭션이 프락시를 거칠 경우 서버가 프락시에 전달하는 응답 엔터티의 Content-Length          |
| client-request-size      | 클라이언트가 프락시로 보내는 요청의 본문이나 엔터티의 Content-Length                         |
| proxy-request-size       | 트랜잭션이 프락시를 거칠 경우 프락시가 서버로 보내는 요청의 본문이나 엔터티의 Content-Length |
| client-request-hdr-size  | 클라이언트 요청 헤더의 바이트 길이                                                           |
| proxy-resonse-hdr-size   | 트랜잭션이 프락시를 거칠 경우 프락시가 요청자에게 보내는 응답 헤더의 바이트 길이             |
| proxy-request-hdr-size   | 트랜잭션이 프락시를 거칠 경우 프락시가 서버로 전송하는 요청 헤더의 바이트 길이               |
| server-response-hdr-size | 서버 응답 헤더의 바이트 길이                                                                 |
| proxy-timestamp          | 트랜잭션이 프락시를 거칠 경우 요청과 응답이 프락시를 통해 오가는 총 시간(초 단위)            |

## 4. 넷스케이프 확장 2 로그 포맷

- 또 다른 넷스케이프 로그 포맷인 넷스케이프 확장 2 로그 포맷은 확장 로그 포맷에서 HTTP 프락시와 웹 캐시 애플리케이션과 관련한 더 많은 정보를 포함한다
- 이렇게 추가된 필드들은 HTTP 클라이언트와 HTTP 프락시 애플리케이션 간의 통신을 설계하는 데 도움이 된다
- 넷스케이프 확장 2 로그 포맷에서 추가된 필드들을 아래에 순서대로 기술

| 필드                      | 설명                                                                                                                      |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| route                     | 프락시가 클라이언트에 요청을 만드는 데 사용하는 경로                                                                      |
| client-finish-status-code | 클라이언트의 종료 상태 코드로 클라이언트가 프락시로 보낸 요청이 성공적으로 완료되었는지 혹은 인터럽트에 걸렸는지 기술한다 |
| proxy-finish-status-code  | 프락시의 종료 상태 코드로 프락시가 서버로 보낸 요청이 성공적으로 완료되었는지 혹은 인터럽트에 걸렸는지 기술한다           |
| cache-result-code         | 캐시 결과 코드로 캐시가 요청에 어떻게 응답했는지 기술한다                                                                 |

- 넷스케이프 라우트 코드

| 값                | 설명                                          |
| ----------------- | --------------------------------------------- |
| DIRECT            | 리소스를 서버에서 바로 가져왔다               |
| PROXY(host:port)  | 리소스를 host라는 프락시를 통해 가져왔다      |
| SOCKS(socks:port) | 리소스를 host 라는 SOCKS 서버를 통해 가져왔다 |

- 넷스케이프의 종료 코드들

| 값      | 설명                                                              |
| ------- | ----------------------------------------------------------------- |
| -       | 요청이 시작되지 않았다                                            |
| FIN     | 요청이 성공적으로 완료되었다                                      |
| INTR    | 요청이 클라이언트에 의해 중단됐거나 프락시/서버에 의해 종료되었다 |
| TIMEOUT | 요청이 프락시/서버의 타임아웃에 걸렸다                            |

- 넷스케이프 캐시 코드들

| 코드               | 설명                                                                                                               |
| ------------------ | ------------------------------------------------------------------------------------------------------------------ |
| -                  | 캐시할 수 없는 리소스다                                                                                            |
| WRITTEN            | 리소스를 캐시에 저장했다                                                                                           |
| REFRESHED          | 리소스를 캐시했고 갱신했다                                                                                         |
| NO-CHECK           | 캐시된 리소스를 반환했고 신선도 검사를 하지 않았다                                                                 |
| UP-TO-DATE         | 캐시된 리소스를 반환했고 신선도 검사를 완료했다                                                                    |
| HOST-NOT-AVAILABLE | 캐시된 리소스를 반환했으며 원격 서버가 사용할 수 있는 상태가 아니었기 때문에 신선도 검사를 하지 않았다             |
| CL-MISMATCH        | 리소스를 캐시에 저장하지 않았다. Content-Length가 리소스의 크기와 맞지 않았기 때문에 쓰기를 중단했다               |
| ERROR              | 어떤 에러 때문에 리소스를 캐시에 저장하지 못했다. 예를 들면 타임아웃이 나거나 클라이언트가 트랜잭션을 중단했을 때. |

- 넷스케이프 애플리케이션은 다른 많은 HTTP 애플리케이션과 마찬가지로 출력될 로그의 포맷을 관리자가 수정할 수 있는 유연한 로그 포맷을 포함한 다양한 로그 포맷으로 가지고 있다
- 이런 포맷이 있기 때문에 관리자는 추가적인 설정을 해서 로그에 기록할 HTTP 트랜잭션의 특정 부분을 선택하여 로그를 최적화할 수 있다
