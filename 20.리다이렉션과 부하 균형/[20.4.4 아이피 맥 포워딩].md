# 20.4.4 아이피 맥 포워딩

- 이더넷 네트워크에서, HTTP메시지는 주소가 붙은 데이터 패킷의 형태로 보내진다.
- 각 패킷은 출발지와 목적지의 아이피 주소와 TCP포트번호로 이루어진 레이어-4주소를 갖고 있다.
- 각 패킷은 레이어2 장비(스위치)가 주의를 기울여야 하는 미디어 접근 컨트롤(MAC) 주소도 갖고 있다.
- 레이어-4 주소를 이해할 수 있는 장비가 있는데, 이 장비는 아이피 주소, TCP 포트번호 MAC 주소를 활용하여 다른 아이피 주소 또는 MAC 주소로 라우팅 할 수 있다.
- MAC 주소 포워딩은 점 대 점으로만 가능하기 때문에, 서버나 프락시는 스위치와 한 홉 거리에 위치해야 한다

![](https://velog.velcdn.com/images/yoose1002/post/a864a9a7-dea4-4591-bbba-c217dea46bea/image.png)

- 레이어4 주소를 검사하여서 선택적 라우팅 가능
- 80 포트는 전부 프락시로 보내지고 있음.
![](https://velog.velcdn.com/images/yoose1002/post/58eba186-3889-41a0-b3b1-fb25e4d581fd/image.png)

- MAC 포워딩을 지원하는 레이어-4 스위치는 보통 요청을 여러 프락시 캐시로 보낼 수 있고 그들 사이의 부하 균형을 유지할 수 있다.

# 20.4.5 아이피 주소 포워딩

- 아이피 주소 포워딩에서, 스위치나 다른 레이어 4를 이해하는 장비는 들어오는 패킷에 대해 TCP/IP 어드레싱을 검증하고 패킷을 목적지 맥 주소가 아니라 목적지 아이피 주소의 변경에 따라 라우팅 한다.
- 목적지 서버가 한 홉 거리에 있을 필요 없이 그저 스위치에서 업스트림의 위치를 판별할 수만 있으면 된다.
- MAC 포워딩 처럼 한 홉간 거리라는 제약은 없지만, 라우팅 대칭성이라는 문제가 있다.
- 클라이언트로부터 들어오는 TCP 커넥션을 받아주는 스위치는 그 커넥션을 관리하고 있어야 한다. 
- 스위치는 반드시 그 커넥션을 통해 클라이언트에게 응답을 돌려주어야 한다.
![](https://velog.velcdn.com/images/yoose1002/post/82571072-47d8-43bb-8927-bc4f8c78d2ed/image.png)

# 20.4.6 네트워크 구성요소 제어 프로토콜

- 네트워크 구성요소 제어 프로토콜(NECP)은 아이피 패킷을 전달하는 라우터나 스위치 같은 네트워크 구성요소(NE)들이 웹 서버나 프락시 캐시와 같이 애플리케이션 계층 요청을 처리하는 서버 구성요소(SE)들과 대화할 수 있게 해 준다.
> NE(Network Element): 라우터나 스위치

> SE(Server Element): 웹 서버, 프락시 캐시
- 부하균형에 대해서 명시적 지원 x
- SE 는 NE 에게 부하 균형 정보를 제공할 수 있는 방법을 제공
- NECP는 MAC 포워딩, GRE캡슐화, NAT와 같은 패킷을 전달하는 여러 방법을 제공한다
 