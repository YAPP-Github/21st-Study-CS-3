# 13.5 보안에 대한 고려사항

## 1. 헤더 부당 변경(13.5.1)

- 헤더 부당 변경에 대해 항상 안전한 시스템을 제공하기 위해서 `양 종단 암호화나 헤더에 대한 디지털 서명`이 필요할 것이다
- 다이제스트 인증은 쉽게 조작할 수 없는 인증 제도를 제공하는 것에 초점을 맞추고 있으나 반드시 그 보호를 데이터에까지 확장하는 것은 아니다
- 보호 수준에 대한 정보는 `WWW-Authenticate, Authorization헤더`에만 담겨있다

## 2. 재전송 공격(13.5.2)

- 이 맥락에서 재전송 공격이란 누군가 어떤 트랜잭션에서 엿들은 인증 자격을 다른 트랜잭션을 위해 사용하는 것을 말한다
- 이 문제는 `GET요청에 대한 이슈이긴 하지만 POST와 PUT요청에 대한 재전송 공격에 대해서도 항상 잘 동작하는 예방책을 필수적으로 가지고 있어야 한다`
- 폼 데이터를 전송할 때 이전에 사용했던 자격을 재사용해도 문제없이 동작해버린다면 이는 끔찍한 보안 악몽을 불러올 것이다
- 서버가 재전송된 자격을 승인해버렸다는 것은, 틀림없이 같은 난스 값을 반복해서 사용한 것
  - 이 문제를 완화시키는 방법 중 하나는 클라이언트의 IP주소, 타임스탬프, 리소스의 ETag, 개인 서버 키에 대힌 요약을 포함하는 난스를 서버가 생성하도록 하는 것. 이런 시나리오에서 IP주소와 짧은 타임아웃 값의 조합은 공격자에게 거대한 난관이 된다
- 이 해법에는 중요한 결점이 있다
  - 난스 생성시 클라이언트의 IP 를 사용하게 되면 같은 사용자로부터 요청이 다른 프락시를 통과하게 될 수도 있는 프락시 팜은 사용할 수 없게 된다
  - 또한 IP 주소를 속이는 것도 그다지 어려운 일이 아님
- 재전송 공격을 완전히 피할 수 있는 한 방법은 매 트랜잭션마다 유일한 난스 값을 사용하는 것
- 이 구현에서는 매 트랜잭션마다 서버는 유일한 난스를 타임아웃 값과 함께 발급
- 발급된 난스 값은 그때의 트랜잭션과 주어진 타임아웃 값의 기간동안만 유효
- 이 계산이 서버에 부하를 가중시킬 수 있으나 사소한 수준

## 3. 다중 인증 메커니즘(13.5.3)

- 서버가 다중 인증 제도를 지원할 때 WWW-Authenticate 헤더를 통해 선택지를 제공할 것
- `클라이언트에게 가장 강력한 인증 메커니즘을 선택해야 할 의무가 있는 것은 아니기 때문에 결국 인증의 강도는 선택지 중 가장 약한 것과 같다고 보아야 한다`
- 이 문제를 피하기 위한 확실한 방법은 클라이언트가 `언제나 가능한 한 가장 강력한 인증 제도를 선택하는 것`
- 현실적으로 불가능하다면 다른 선택지는 가장 강력한 인증 제도만을 유지하는 프락시 서버를 사용하는 것
- 그러나 이런 접근은 오직 모든 클라이언트가 우리가 선택한 강력한 인증 제도를 지원할 수 있다고 알려진 경우에만 실현 가능

## 4. 사전 공격(13.5.4)

- 사전 공격은 전형적인 비밀번호 추측 공격
- 악의적인 사용자는 트랜잭션을 엿들을 수 있고 난스/응답 쌍에 대해 흔히 구할 수 있는 비밀번호 추측 프로그램을 사용할 수 있다
- 이 문제를 해결할 좋은 방법은 크래킹하기 어렵도록 상대적으로 복잡한 비밀번호를 사용하는 것과 괜찮은 비밀번호 만료 정책 외에는 실질적으로 없다

## 5. 악의적인 프락시와 중간자 공격(13.5.5)

- 많은 인터넷 트래픽이 오늘날 한 프락시에서 다른 프락시로 이동
  - 리다이렉션 기술과 차단 프락시의 도입으로 사용자는 그의 요청이 프락시를 통과한다는 것조차 눈치 채지 못하곤 한다
  - 만약 이들 프락시 중 하나가 악의적이거나 보안이 허술하다면 클라이언트는 중간자 공격에 취약한 상태가 될 가능성이 있다
  - 이러한 공격은 엿듣기 공격일 수도 있고 혹은 인증 제도 선책지를 모두 제거하고 기본 인증과 같이 가장 약한 인증 제도로 대체하는 것일 수도 있다
- 신뢰할 수 있는 프락시의 신뢰도에 흠집을 낼 수 있는 것 중 하나는 역설적이게도 `프락시 자신의 확장 인터페이스`
- 프락시는 보통 정교한 프로그래밍 인터페이스를 제공하므로 그러한 프락시들을 이용하는 확장을 작성하여 트래픽을 가로채 수정하는것은 가능한 일
- 다만 데이터 센터의 보안과 프락시 자체가 제공하는 보안은 악의적인 플러그인을 통한 중간자 공격의 가능성을 매우 희박하게 함
- 이 문제를 해결할 좋은 방법은 없다
  - 가능한 해결책은 클라이언트가 사용자에게 인증의 강도를 시각적으로 보여주는 것, 클라이언트가 언제나 가능한 한 가장 강력한 인증을 선택하도록 설정하는 것 등이 있다
  - 그러나 가능한 한 가장 강한 인증 제도를 사용한다 해도 클라이언트는 여전히 도청에 취약하며 이런 공격을 방어할 유일한 실패하지 않는 방법은 SSL을 사용하는 것

## 6. 선택 평문 공격(13.5.6)

- 다이제스트 인증을 사용하는 클라이언트는 응답을 생성하기 위해 서버가 제공한 난스를 사용
- 그러나 만약 보안이 허술하거나 악의적인 프락시가 트래픽 중간에 끼어든다면 그것은 어렵지 않게 클라이언트가 응답 계산을 하기 위한 난스를 제공할 수 있다
- 응답을 계산하기 위해 알려진 키를 사용하는 것은 응답의 암호 해독을 쉽게 한다
- 이것은 선택 평문 공격이라 부르며 선택 평문 공격에는 몇가지 변종이 있다

  ### 미리 계산된 사전 공격

  - 이것은 사전 공격과 선택 평문 공격의 조합
  - 먼저 공격 서버는 미리 결정된 난스와 자주 쓰이는 비밀번호들로 응답의 집합을 생성하고 사전을 만든다
  - 일단 꽤 큰 사전이 만들어지면 공격 서버/프락시는 트래픽을 차단하고 미리 결정된 난스를 클라이언트로 전송하기 시작한다
  - 클라이언트로부터 응답을 받을 때 공격자는 대응되는 항목을 생성한 사전에서 찾는다
  - 만약 대응되는 것이 있으면 공격자는 특정 사용자의 비밀번호를 손에 넣은 것

  ### 자동화된 무차별 대입 공격

  - 자동화된 무제한 공격의 차이점은 비밀번호의 계산에 있다
    - 미리 계산된 요약을 맞춰보려 시도하는 대신 많은 컴퓨터를 동원해 주어진 범위에서 가능한 모든 비밀번호를 열거
    - 컴퓨터가 빨라질수록 무제한 공격의 성공가능성은 점점 높아짐

- 이런 공격으로 인한 위협을 방어하는 방법

1. 클라이언트가 서버에서 제공된 난스 대신 선택적인 c난스 지시자를 사용하여 응답을 생성할 수 있도록 설정
2. 납득할만큼 강력한 비밀번호를 강제하는 정책과 좋은 비밀번호 만료 메커니즘이 더해지면 선택 평문 공격의 위협은 완전히 경감시킬 수 있다

## 7. 비밀번호 저장(13.5.7)

- 다이제스트 인증 메커니즘은 사용자 응답을 서버 내부에 저장된 것과 비교
- 유닉스 장치의 전통적인 비밀번호 파일과는 달리 다이제스트 인증 비밀번호 파일이 유출되면 영역의 모든 문서는 즉각 공격자에게 노출. 암호 해독과정은 필요없음
- 이 문제를 완화하는 몇가지 방법은 다음과 같다
  - 비밀번호 파일이 평문으로 된 비밀번호를 포함하고 있다고 생각하고 안전하게 보호
  - 영역 이름이 유일함을 보장하며 비밀번호 파일이 유출되더라도 피해를 특정 영역으로 국소화한다. 호스트와 도메인을 포함한 완전한 영역 이름은 이 요구를 만족한다.
- 다이제스트 인증이 기본 인증에 비해 훨씬 탄탄하고 안전한 해결책을 제공함에도 불구하고 여전히 콘텐츠에 대한 보안 측면에서는 어떠한 보호도 제공하지 못한다
- 진정한 보안 트랜잭션은 오로지 다음장에서 다룰 SSL을 통해서만 가능
