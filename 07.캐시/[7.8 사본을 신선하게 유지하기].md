- 캐시된 사본이 서버와 일치할 수 있도록(신선도 유지) 하는 매커니즘 : 문서 만료 / 서버 재검사

## 문서 만료
- `cache control : max-age / expires` : 유효기간과 나이를 명시할 수 있음
![](https://velog.velcdn.com/images/yoose1002/post/4f362f1f-ab80-485d-8e38-623f0f87caef/image.png)

- 유효 기간을 지나지 않았다면 서버와의 접촉 없이 신선도 검사 pass
- `cache control : max-age` : 문서의 최대 나이를 정의한다. 처음 생성된 이후부터, 더 이상 신선하지 않다고 간주될 때까지 경과한 시간의 최대값(초단위)
- `Expires` : 절대 유효기간을 명시한다. 

## 서버 재검사
- 캐시된 문서가 만료되었다는 것은, 검사할 시간이 되었다는 의미
- 재검사 결과, 컨텐츠가 변경되었다면 캐시는 그 문서의 사본을 가져와 저장하고 클라이언트에게도 보내준다.
- 재검사 결과, 컨텐츠가 그대로라면 캐시는 새 만료일을 포함한 새 헤더들만 가져와 갱신한다.

## 조건부 메서드와의 재검사
- HTTP는 캐시가 서버에게 '조건부 GET'이라는 요청을 보내서 재검사를 효율적으로 실행
- HTTP는 다섯 가지 조건부 요청 헤더를 정의하는데, 그 중 둘은 캐시 재검사에 유용한 `If-Modified-Since`와 `If-None-Match`이다.

## If-Modified-Since : date 헤더
![](https://velog.velcdn.com/images/yoose1002/post/4431c796-fc4f-466f-a25d-f2b3aa11a6a0/image.png)

- 서버에게 리소스가 특정 날짜 이후로 변경된 경우에만 요청 본문을 보내달라고 한다.
- 서버 응답 헤더의 Last-Modified 헤더와 함께 동작
- 캐시는 문서가 캐시된 날짜를 IMS에 보관하고, 원 서버는 제공하는 문서의 최근 변경 일시를 LM에 붙인다.
- IMS와 LM을 비교해서 IMS 날짜 이후에 서버의 문서가 변경되었다면, 원 서버는 새 문서를 주고 그렇지 않다면, `304 Not Modified` 응답을 돌려준다.

## If-None-Match : tags 헤더
![](https://velog.velcdn.com/images/yoose1002/post/a6de64ac-c93e-464e-bc4c-f92336dbdea3/image.png)

- 시간을 비교하는 것만으로 서버 재검사가 이루어질 수 없는 경우(1초 단위로 갱신, 리소스는 바뀌지 않지만 계속 업데이트)
- 엔터티 태그를 비교해서 태그가 같다면 리소스가 유효함을 확인 가능
- 다르다면 `새로운 엔터티 태그 + 본문` 응답 메시지 전송
- 캐시가 객체에 대해 여러가지 사본을 가진 경우 -> 여러 개의 엔터티 태그 넣을 수 있음

## Weak Validator (약한 검사기)
문서가 조금 변경되었더라도 그 정도면 같은 것이라고 서버가 주장할 수 있도록 해줌
아래와 같이 사용
```
Etag: W/"v2.6"
If-None-Match: W/"v.2.6"
```
- 엔터티 태그는 재활용 불가능 

** 엔터티 태그 검사, 날짜 검사를 모두 시행하는 경우 : 두 가지 조건을 모두 만족할 때만 `304 not modified` 메시지를 반환 가능
